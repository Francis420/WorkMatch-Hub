{% extends 'base.html' %}
{% load static %}

{% block title %}Notifications{% endblock %}

{% block content %}
<h2>Notifications</h2>
<ul id="notification-list" class="list-group">
    {% for notification in notifications %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
                {% if notification.sender %}
                    {{ notification.sender.username }} has applied for your job posting: {{ notification.target.title }}
                {% else %}
                    <span class="text-danger">Sender not available</span>
                {% endif %}
                <span>{{ notification.timestamp }}</span>
            </div>
            <div>
                {% if notification.sender and notification.sender.id %}
                    <a href="{% url 'job_seeker_profile' pk=notification.sender.id %}" class="btn btn-sm btn-primary">Show Profile</a>
                {% else %}
                    <span class="text-muted">Profile not available</span>
                {% endif %}
                {% if not notification.read %}
                    <button class="btn btn-sm btn-secondary mark-read" data-id="{{ notification.id }}">Mark as Read</button>
                {% endif %}
            </div>
        </li>
    {% endfor %}
</ul>

<script>
    document.querySelectorAll('.mark-read').forEach(button => {
        button.addEventListener('click', function() {
            const notificationId = this.getAttribute('data-id');
            fetch(`/notifications/mark_read/${notificationId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json'
                }
            }).then(response => {
                if (response.ok) {
                    this.parentElement.remove();
                    const notificationCount = document.getElementById('notification-count');
                    notificationCount.textContent = parseInt(notificationCount.textContent) - 1;
                }
            });
        });
    });
</script>
{% endblock %}